{% macro nodetype_table(node_types, system='casper') %}
<div class="table-responsive">
    <table class="table table-sm table-bordered nodetype-table">
        <thead class="thead-light">
            <tr>
                <th>Node Type</th>
                <th>Specs</th>
                <th>Total</th>
                <th>Available</th>
                <th>Down</th>
                <th>Allocated</th>
                <th>Utilization</th>
            </tr>
        </thead>
        <tbody>
            {% for nt in node_types %}
            <tr class="clickable-row" onclick="window.location='{{ url_for('status_dashboard.nodetype_history', system=system, node_type=nt.node_type) }}';" title="Click to view history for {{ nt.node_type }}">
                <td><strong>{{ nt.node_type }}</strong></td>
                <td>
                    <small>
                        {{ nt.cores_per_node }} cores,
                        {{ nt.memory_gb_per_node }} GB RAM
                        {% if nt.gpu_model %}<br>{{ nt.gpus_per_node }}x {{ nt.gpu_model }}{% endif %}
                    </small>
                </td>
                <td>{{ nt.nodes_total }}</td>
                <td class="text-success">{{ nt.nodes_available }}</td>
                <td class="text-danger">{{ nt.nodes_down }}</td>
                <td class="text-warning">{{ nt.nodes_allocated }}</td>
                <td>
                    {% if nt.utilization_percent is not none %}
                    <div class="mb-1">
                        <small class="text-muted">{{ 'GPU' if nt.gpu_model else 'CPU' }}:</small>
                        <div class="progress progress-medium">
                            <div class="progress-bar bg-{{ 'danger' if nt.utilization_percent >= 90 else 'warning' if nt.utilization_percent >= 75 else 'success' }}"
                                 style="width: {{ nt.utilization_percent }}%">
                                <small>{{ nt.utilization_percent|round(1) }}%</small>
                            </div>
                        </div>
                    </div>
                    {% if nt.memory_utilization_percent is not none %}
                    <div>
                        <small class="text-muted">Mem:</small>
                        <div class="progress progress-medium">
                            <div class="progress-bar bg-{{ 'danger' if nt.memory_utilization_percent >= 90 else 'warning' if nt.memory_utilization_percent >= 75 else 'info' }}"
                                 style="width: {{ nt.memory_utilization_percent }}%">
                                <small>{{ nt.memory_utilization_percent|round(1) }}%</small>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    {% else %}
                    N/A
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endmacro %}
