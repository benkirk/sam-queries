{% extends 'dashboards/base.html' %}

{% block title %}System Status Dashboard{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/status.css') }}">
{% endblock %}

{% block content %}
<meta http-equiv="refresh" content="300">

<!-- Page Header -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="fas fa-server"></i> System Status Dashboard</h2>
    <div class="last-updated">
        <i class="fas fa-clock"></i> Auto-refresh every 5 minutes
    </div>
</div>

<!-- Active Outages Banner -->
{% if outages %}
<div class="alert alert-warning mb-4">
    <h5><i class="fas fa-exclamation-triangle"></i> Active System Issues ({{ outages|length }})</h5>
    {% for outage in outages %}
    <div class="outage-card card severity-{{ outage.severity }}">
        <div class="card-body">
            <div class="d-flex justify-content-between">
                <div>
                    <strong>{{ outage.system_name|upper }}</strong>
                    {% if outage.component %} - {{ outage.component }}{% endif %}
                    <span class="badge badge-{{ 'danger' if outage.severity == 'critical' else 'warning' if outage.severity == 'major' else 'info' }}">
                        {{ outage.severity }}
                    </span>
                </div>
                <div class="text-muted small">
                    {{ outage.start_time.strftime('%Y-%m-%d %H:%M') }}
                </div>
            </div>
            <div class="mt-2">
                <strong>{{ outage.title }}</strong>
            </div>
            {% if outage.description %}
            <div class="text-muted">{{ outage.description }}</div>
            {% endif %}
            {% if outage.estimated_resolution %}
            <div class="text-muted small mt-1">
                <i class="fas fa-clock"></i> Estimated resolution: {{ outage.estimated_resolution.strftime('%Y-%m-%d %H:%M') }}
            </div>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>
{% endif %}

<!-- Tab Navigation -->
<ul class="nav nav-tabs mb-4" id="statusTabs" role="tablist">
    <li class="nav-item">
        <a class="nav-link active" id="derecho-tab" data-toggle="tab" href="#derecho" role="tab">
            <i class="fas fa-server"></i> Derecho
        </a>
    </li>
    <li class="nav-item">
        <a class="nav-link" id="casper-tab" data-toggle="tab" href="#casper" role="tab">
            <i class="fas fa-hdd"></i> Casper
        </a>
    </li>
    <li class="nav-item">
        <a class="nav-link" id="jupyterhub-tab" data-toggle="tab" href="#jupyterhub" role="tab">
            <i class="fas fa-book"></i> JupyterHub
        </a>
    </li>
    {% if reservations %}
    <li class="nav-item">
        <a class="nav-link" id="reservations-tab" data-toggle="tab" href="#reservations" role="tab">
            <i class="fas fa-calendar-alt"></i> Reservations ({{ reservations|length }})
        </a>
    </li>
    {% endif %}
</ul>

<!-- Tab Content -->
<div class="tab-content" id="statusTabContent">
    <div class="tab-pane fade show active" id="derecho" role="tabpanel">
        {% include 'dashboards/status/derecho.html' %}
    </div>
    <div class="tab-pane fade" id="casper" role="tabpanel">
        {% include 'dashboards/status/casper.html' %}
    </div>
    <div class="tab-pane fade" id="jupyterhub" role="tabpanel">
        {% include 'dashboards/status/jupyterhub.html' %}
    </div>
    {% if reservations %}
    <div class="tab-pane fade" id="reservations" role="tabpanel">
        {% include 'dashboards/status/fragments/reservations.html' %}
    </div>
    {% endif %}
</div>

{% endblock %}
