{% if abandoned_users %}
<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead class="thead-light">
            <tr>
                <th>Username</th>
                <th>Name</th>
                <th>Email</th>
                <th>Expired Projects</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for user_info in abandoned_users %}
            <tr>
                <td><strong>{{ user_info.username }}</strong></td>
                <td>{{ user_info.display_name }}</td>
                <td>
                    {% if user_info.email != 'N/A' %}
                    <a href="mailto:{{ user_info.email }}">{{ user_info.email }}</a>
                    {% else %}
                    {{ user_info.email }}
                    {% endif %}
                </td>
                <td>
                    <small>
                        {% set project_codes = user_info.projects.split(', ') %}
                        {% for projcode in project_codes %}
                            <a href="#" class="badge badge-secondary project-code-link"
                               data-projcode="{{ projcode }}"
                               title="Click to view {{ projcode }} details">
                                {{ projcode }}
                            </a>{% if not loop.last %} {% endif %}
                        {% endfor %}
                    </small>
                </td>
                <td>
                    <button type="button"
                            class="btn btn-sm btn-outline-primary impersonate-user-btn"
                            data-username="{{ user_info.username }}">
                        <i class="fas fa-user-secret"></i> Impersonate
                    </button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="text-muted text-center mt-3">
    <small>{{ abandoned_users|length }} abandoned user{{ 's' if abandoned_users|length != 1 else '' }}</small>
</div>
{% else %}
<div class="alert alert-success">
    <i class="fas fa-check-circle"></i>
    No abandoned users found with current filters.
</div>
{% endif %}
