<!-- Project Details Table -->
<table class="table table-sm table-striped">
    <thead>
        <tr>
            <th>Project</th>
            <th>Title</th>
            <th>Amount</th>
            <th>
                {% if resource_type in ['DISK', 'ARCHIVE'] %}
                    Data Volume
                {% else %}
                    Annual Rate
                {% endif %}
            </th>
            <th>Start Date</th>
            <th>End Date</th>
            <th>Duration (days)</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for project in projects %}
        <tr>
            <td>
                <button class="btn btn-link p-0 view-project-details-btn"
                        data-projcode="{{ project['projcode'] }}"
                        title="View project details">
                    <strong>{{ project['projcode'] }}</strong>
                </button>
            </td>
            <td>{{ project['title'] if project['title'] else 'N/A' }}</td>
            <td>{{ "{:,.0f}".format(project['total_amount']) }}</td>
            <td>
                {% if resource_type in ['DISK', 'ARCHIVE'] %}
                    {{ "{:,.0f}".format(project['total_amount']) }}
                {% else %}
                    {% if project['annualized_rate'] is not none %}
                        {{ "{:,.0f}".format(project['annualized_rate']) }}
                    {% else %}
                        N/A
                    {% endif %}
                {% endif %}
            </td>
            <td>{{ project['start_date'].strftime('%Y-%m-%d') if project['start_date'] else 'N/A' }}</td>
            <td>
                {% if project['end_date'] %}
                    {{ project['end_date'].strftime('%Y-%m-%d') }}
                {% elif project['is_open_ended'] %}
                    <span class="badge badge-info">Open-ended</span>
                {% else %}
                    N/A
                {% endif %}
            </td>
            <td>
                {% if project['duration_days'] %}
                    {{ project['duration_days'] }}
                    {% if project['is_open_ended'] %}
                        <span class="text-muted small">(est.)</span>
                    {% endif %}
                {% else %}
                    N/A
                {% endif %}
            </td>
            <td>
                <button class="btn btn-sm btn-outline-primary view-usage-btn"
                        data-projcode="{{ project['projcode'] }}"
                        data-resource="{{ resource }}"
                        data-active-at="{{ active_at }}"
                        title="View usage details">
                    <i class="fas fa-eye"></i>
                </button>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% if projects|length > 0 %}
<div class="text-muted small">
    Showing {{ projects|length }} project{{ 's' if projects|length != 1 else '' }}
</div>
{% endif %}
