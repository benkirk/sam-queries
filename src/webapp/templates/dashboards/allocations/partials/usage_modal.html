<!-- Usage Details Modal Content -->
{% if allocation %}
<div class="usage-details">
    <!-- Header -->
    <div class="mb-3">
        <h6>Project: <strong>{{ project.projcode }}</strong></h6>
        {% if project.title %}
        <p class="text-muted mb-1">{{ project.title }}</p>
        {% endif %}
        <p class="mb-1">Resource: <strong>{{ resource }}</strong></p>
        <p class="text-muted small">Active at: {{ active_at }}</p>
    </div>

    <!-- Allocation Period -->
    <div class="card mb-3">
        <div class="card-header">
            <h6 class="mb-0">Allocation Period</h6>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4">
                    <strong>Start Date:</strong><br>
                    {{ allocation.start_date.strftime('%Y-%m-%d') if allocation.start_date else 'N/A' }}
                </div>
                <div class="col-md-4">
                    <strong>End Date:</strong><br>
                    {% if allocation.end_date %}
                        {{ allocation.end_date.strftime('%Y-%m-%d') }}
                    {% elif allocation.is_open_ended %}
                        <span class="badge badge-info">Open-ended</span>
                    {% else %}
                        N/A
                    {% endif %}
                </div>
                <div class="col-md-4">
                    <strong>Duration:</strong><br>
                    {% if allocation.duration_days %}
                        {{ allocation.duration_days }} days
                        {% if allocation.is_open_ended %}
                            <span class="text-muted small">(estimated)</span>
                        {% endif %}
                    {% else %}
                        N/A
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Summary Stats -->
    <div class="card mb-3">
        <div class="card-header">
            <h6 class="mb-0">Usage Summary</h6>
        </div>
        <div class="card-body">
            <div class="row mb-3">
                <div class="col-md-3">
                    <div class="text-muted small">Allocated</div>
                    <div class="h5 mb-0">{{ "{:,.0f}".format(allocation.total_allocated) }}</div>
                </div>
                <div class="col-md-3">
                    <div class="text-muted small">Used</div>
                    <div class="h5 mb-0">{{ "{:,.0f}".format(allocation.total_used) }}</div>
                </div>
                <div class="col-md-3">
                    <div class="text-muted small">Remaining</div>
                    <div class="h5 mb-0">{{ "{:,.0f}".format(allocation.total_allocated - allocation.total_used) }}</div>
                </div>
                <div class="col-md-3">
                    <div class="text-muted small">% Used</div>
                    <div class="h5 mb-0">
                        {% set percent = allocation.percent_used %}
                        <span class="badge badge-{% if percent >= 90 %}danger{% elif percent >= 75 %}warning{% else %}success{% endif %}">
                            {{ "%.1f"|format(percent) }}%
                        </span>
                    </div>
                </div>
            </div>

            <!-- Progress Bar -->
            <div class="progress" style="height: 25px;">
                {% set percent = allocation.percent_used %}
                <div class="progress-bar {% if percent >= 90 %}bg-danger{% elif percent >= 75 %}bg-warning{% else %}bg-success{% endif %}"
                     role="progressbar"
                     style="width: {{ percent }}%">
                    {{ "%.1f"|format(percent) }}%
                </div>
            </div>
        </div>
    </div>

    <!-- Charges Breakdown -->
    {% if allocation.charges_by_type %}
    <div class="card">
        <div class="card-header">
            <h6 class="mb-0">Charges by Type</h6>
        </div>
        <div class="card-body">
            <table class="table table-sm">
                <thead>
                    <tr>
                        <th>Type</th>
                        <th class="text-right">Amount</th>
                        <th class="text-right">% of Total</th>
                    </tr>
                </thead>
                <tbody>
                    {% for charge_type, amount in allocation.charges_by_type.items() %}
                    {% if amount != 0 %}
                    <tr>
                        <td>{{ charge_type|upper }}</td>
                        <td class="text-right">{{ "{:,.2f}".format(amount) }}</td>
                        <td class="text-right">
                            {% if allocation.total_used > 0 %}
                                {{ "%.1f"|format((amount / allocation.total_used) * 100) }}%
                            {% else %}
                                0.0%
                            {% endif %}
                        </td>
                    </tr>
                    {% endif %}
                    {% endfor %}
                </tbody>
                <tfoot>
                    <tr class="font-weight-bold">
                        <td>Total</td>
                        <td class="text-right">{{ "{:,.2f}".format(allocation.total_used) }}</td>
                        <td class="text-right">100.0%</td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>
    {% endif %}
</div>
{% else %}
<div class="alert alert-warning">
    No allocation data available for this project and resource.
</div>
{% endif %}
